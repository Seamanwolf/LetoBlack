{% extends "base.html" %}

{% block title %}Колл-центр{% endblock %}
{% block page_title %}Колл-центр{% endblock %}

{% block top_nav %}
{% endblock %}

{% block extra_css %}
<style>
/* Стили для боковой панели */
.sidebar {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    width: 60px;
    background: #2c3e50;
    display: flex;
    flex-direction: column;
    padding-top: 20px;
    z-index: 1000;
    box-shadow: 3px 0 10px rgba(0, 0, 0, 0.1);
}

.sidebar .logo {
    color: #fff;
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 30px;
}

.sidebar a {
    color: #fff;
    text-decoration: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 0;
    font-size: 0.75rem;
    transition: all 0.3s;
}

.sidebar a i {
    font-size: 1.2rem;
    margin-bottom: 3px;
}

.sidebar a:hover {
    background-color: #34495e;
}

.sidebar a.active {
    background-color: #3498db;
}

/* Стили для верхней панели */
.topbar {
    margin-left: 60px;
    padding: 15px 30px;
    background: white;
    height: 60px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    position: fixed;
    top: 0;
    right: 0;
    left: 0;
    z-index: 900;
}

.topbar .title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2c3e50;
}

/* Стили для основного контента */
.main-content {
    margin-left: 60px;
    padding-top: 80px;
    padding-bottom: 30px;
}

/* Основные стили и переменные */
:root {
    --primary-color: #3498db;
    --primary-dark: #2980b9;
    --success-color: #2ecc71;
    --warning-color: #f1c40f;
    --danger-color: #e74c3c;
    --text-dark: #2c3e50;
    --text-muted: #6c757d;
    --gray-light: #f8f9fa;
    --border-color: #dee2e6;
}

/* Стили для карточек статистики */
.call-center-card {
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    background-color: white;
    margin-bottom: 1.5rem;
    overflow: hidden;
}

.call-center-card .card-body {
    padding: 1.8rem;
}

.call-center-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
}

.call-center-card .card-title {
    color: var(--text-muted);
    font-size: 0.95rem;
    font-weight: 500;
    margin-bottom: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.call-center-card .card-text {
    color: var(--text-dark);
    font-weight: 700;
    font-size: 2rem;
    margin-bottom: 0;
}

/* Стили для таблиц */
.call-center-table {
    margin-bottom: 0;
    background-color: white;
    border-radius: 12px;
    overflow: hidden;
    width: 100%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.call-center-table th {
    background-color: var(--gray-light);
    border-bottom: 2px solid var(--border-color);
    color: var(--text-muted);
    font-weight: 600;
    padding: 1.2rem 1.5rem;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
}

.call-center-table td {
    vertical-align: middle;
    padding: 1.2rem 1.5rem;
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.call-center-table tr:hover {
    background-color: rgba(52, 152, 219, 0.03);
}

/* Стили для бейджей статусов */
.call-center-badge {
    padding: 0.5em 0.85em;
    font-weight: 600;
    font-size: 0.8rem;
    border-radius: 50px;
    color: white;
    display: inline-block;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.call-center-badge.bg-active {
    background-color: var(--success-color);
}

.call-center-badge.bg-inactive {
    background-color: var(--danger-color);
}

.call-center-badge.bg-processed {
    background-color: var(--success-color);
}

.call-center-badge.bg-in_process {
    background-color: var(--warning-color);
}

/* Стили для вкладок */
.call-center-tabs {
    border-bottom: 2px solid var(--border-color);
    margin-bottom: 2rem;
    background-color: white;
    padding: 0 1.2rem;
    border-radius: 12px 12px 0 0;
    display: flex;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
}

.call-center-tabs .nav-item {
    margin-bottom: -2px;
}

.call-center-tabs .nav-link {
    border: none;
    color: var(--text-muted);
    font-weight: 500;
    padding: 1rem 1.2rem;
    margin-right: 1.2rem;
    display: flex;
    align-items: center;
    transition: all 0.2s ease;
}

.call-center-tabs .nav-link:hover {
    border: none;
    color: var(--primary-color);
    background-color: rgba(52, 152, 219, 0.05);
}

.call-center-tabs .nav-link.active {
    color: var(--primary-color);
    border: none;
    border-bottom: 3px solid var(--primary-color);
    font-weight: 600;
}

.call-center-tabs .nav-link i {
    margin-right: 0.7rem;
    font-size: 1.1rem;
}

/* Стили для кнопок */
.call-center-btn {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
    padding: 0.6rem 1.2rem;
    font-weight: 500;
    color: white;
    border-radius: 50px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
}

.call-center-btn:hover {
    background-color: var(--primary-dark);
    border-color: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(52, 152, 219, 0.3);
}

/* Стили для графиков */
.call-center-chart {
    height: 250px;
    width: 100%;
    margin: 1rem 0;
}

/* Общие стили */
.section-heading {
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    border-left: 4px solid var(--primary-color);
    padding-left: 1rem;
}

.mb-5 {
    margin-bottom: 3rem !important;
}

.card-container {
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    padding: 2rem;
    margin-bottom: 2rem;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Статистика -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="call-center-card card">
                <div class="card-body">
                    <h6 class="card-title">Всего операторов</h6>
                    <p class="card-text">{{ stats.total_operators }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="call-center-card card">
                <div class="card-body">
                    <h6 class="card-title">Активные операторы</h6>
                    <p class="card-text">{{ stats.active_operators }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="call-center-card card">
                <div class="card-body">
                    <h6 class="card-title">Звонков сегодня</h6>
                    <p class="card-text">{{ stats.calls_today }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="call-center-card card">
                <div class="card-body">
                    <h6 class="card-title">Среднее время звонка</h6>
                    <p class="card-text">{{ stats.avg_call_duration }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Вкладки -->
    <ul class="call-center-tabs nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#dashboard">
                <i class="fas fa-chart-line"></i> Дашборд
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#operators">
                <i class="fas fa-users"></i> Операторы
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#numbers">
                <i class="fas fa-phone"></i> Номера
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#database">
                <i class="fas fa-database"></i> База данных
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#reports">
                <i class="fas fa-file-alt"></i> Отчеты
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#integrations">
                <i class="fas fa-plug"></i> Интеграции
            </a>
        </li>
    </ul>

    <!-- Содержимое вкладок -->
    <div class="tab-content">
        <!-- Дашборд -->
        <div class="tab-pane fade show active" id="dashboard">
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="call-center-card card">
                        <div class="card-body">
                            <h5 class="card-title">Динамика звонков за неделю</h5>
                            <div class="call-center-chart">
                                <canvas id="weeklyCallsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="call-center-card card">
                        <div class="card-body">
                            <h5 class="card-title">Распределение звонков по часам</h5>
                            <div class="call-center-chart">
                                <canvas id="hourlyCallsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="call-center-card card">
                        <div class="card-body">
                            <h5 class="card-title">Активность операторов</h5>
                            <div class="call-center-chart">
                                <canvas id="operatorsActivityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="call-center-card card">
                        <div class="card-body">
                            <h5 class="card-title">Успешность звонков</h5>
                            <div class="call-center-chart">
                                <canvas id="callsSuccessChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Операторы -->
        <div class="tab-pane fade" id="operators">
            <div class="call-center-card card">
                <div class="card-body">
                    <div class="call-center-table-responsive">
                        <table class="call-center-table table table-striped">
                            <thead>
                                <tr>
                                    <th>Оператор</th>
                                    <th>Статус</th>
                                    <th>Активные звонки</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for operator in operators %}
                                <tr>
                                    <td>{{ operator.name }}</td>
                                    <td>
                                        <span class="call-center-badge badge {% if operator.status == 'active' %}bg-active{% else %}bg-inactive{% endif %}">
                                            {{ operator.status }}
                                        </span>
                                    </td>
                                    <td>{{ operator.active_calls }}</td>
                                    <td>
                                        <button class="call-center-btn btn btn-sm">Редактировать</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Номера -->
        <div class="tab-pane fade" id="numbers">
            <div class="call-center-card card">
                <div class="card-body">
                    <div class="call-center-table-responsive">
                        <table class="call-center-table table table-striped">
                            <thead>
                                <tr>
                                    <th>Номер</th>
                                    <th>Статус</th>
                                    <th>Оператор</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for number in numbers %}
                                <tr>
                                    <td>{{ number.phone }}</td>
                                    <td>
                                        <span class="call-center-badge badge {% if number.status == 'active' %}bg-active{% else %}bg-inactive{% endif %}">
                                            {{ number.status }}
                                        </span>
                                    </td>
                                    <td>{{ number.operator }}</td>
                                    <td>
                                        <button class="call-center-btn btn btn-sm">Редактировать</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- База данных -->
        <div class="tab-pane fade" id="database">
            <div class="call-center-card card">
                <div class="card-body">
                    <div class="call-center-table-responsive">
                        <table class="call-center-table table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Статус</th>
                                    <th>Оператор</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in database_records %}
                                <tr>
                                    <td>{{ record.id }}</td>
                                    <td>
                                        <span class="call-center-badge badge {% if record.status == 'processed' %}bg-processed{% else %}bg-in_process{% endif %}">
                                            {{ record.status }}
                                        </span>
                                    </td>
                                    <td>{{ record.operator }}</td>
                                    <td>
                                        <button class="call-center-btn btn btn-sm">Редактировать</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Отчеты -->
        <div class="tab-pane fade" id="reports">
            <div class="row">
                <div class="col-md-6">
                    <div class="call-center-card card">
                        <div class="card-body">
                            <h5 class="card-title">Звонки по дням</h5>
                            <div class="call-center-chart">
                                <canvas id="callsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="call-center-card card">
                        <div class="card-body">
                            <h5 class="card-title">Активность операторов</h5>
                            <div class="call-center-chart">
                                <canvas id="operatorsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Интеграции -->
        <div class="tab-pane fade" id="integrations">
            <div class="row">
                <div class="col-md-6">
                    <div class="call-center-card card">
                        <div class="card-body">
                            <h5 class="card-title">Авито Про</h5>
                            <p class="card-text">Интеграция с Авито Про для автоматизации звонков</p>
                            <button class="call-center-btn btn">Подключить</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="call-center-card card">
                        <div class="card-body">
                            <h5 class="card-title">Ватс</h5>
                            <p class="card-text">Интеграция с WhatsApp для обмена сообщениями</p>
                            <button class="call-center-btn btn">Подключить</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Инициализация графиков дашборда
    const weeklyCallsCtx = document.getElementById('weeklyCallsChart').getContext('2d');
    new Chart(weeklyCallsCtx, {
        type: 'line',
        data: {
            labels: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],
            datasets: [{
                label: 'Всего звонков',
                data: [85, 72, 90, 81, 95, 55, 40],
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                tension: 0.3,
                fill: true
            }, {
                label: 'Успешные',
                data: [65, 59, 75, 70, 82, 42, 33],
                borderColor: '#2ecc71',
                backgroundColor: 'rgba(46, 204, 113, 0.1)',
                tension: 0.3,
                fill: true
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                }
            }
        }
    });

    const hourlyCallsCtx = document.getElementById('hourlyCallsChart').getContext('2d');
    new Chart(hourlyCallsCtx, {
        type: 'bar',
        data: {
            labels: ['8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00'],
            datasets: [{
                label: 'Количество звонков',
                data: [12, 19, 27, 30, 22, 18, 29, 35, 40, 38, 25, 15],
                backgroundColor: 'rgba(52, 152, 219, 0.7)',
                borderWidth: 0,
                borderRadius: 4
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    const operatorsActivityCtx = document.getElementById('operatorsActivityChart').getContext('2d');
    new Chart(operatorsActivityCtx, {
        type: 'bar',
        data: {
            labels: ['Оператор 1', 'Оператор 2', 'Оператор 3', 'Оператор 4', 'Оператор 5'],
            datasets: [{
                label: 'Звонки',
                data: [42, 35, 28, 47, 31],
                backgroundColor: 'rgba(52, 152, 219, 0.7)',
                borderWidth: 0,
                borderRadius: 4
            }, {
                label: 'Успешные',
                data: [32, 28, 21, 40, 25],
                backgroundColor: 'rgba(46, 204, 113, 0.7)',
                borderWidth: 0,
                borderRadius: 4
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                }
            }
        }
    });

    const callsSuccessCtx = document.getElementById('callsSuccessChart').getContext('2d');
    new Chart(callsSuccessCtx, {
        type: 'doughnut',
        data: {
            labels: ['Успешные', 'Неуспешные', 'Пропущенные'],
            datasets: [{
                data: [70, 15, 15],
                backgroundColor: [
                    'rgba(46, 204, 113, 0.7)',
                    'rgba(231, 76, 60, 0.7)',
                    'rgba(241, 196, 15, 0.7)'
                ],
                borderColor: [
                    'rgba(46, 204, 113, 1)',
                    'rgba(231, 76, 60, 1)',
                    'rgba(241, 196, 15, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    });

    // Инициализация других графиков
    const callsCtx = document.getElementById('callsChart').getContext('2d');
    new Chart(callsCtx, {
        type: 'line',
        data: {
            labels: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],
            datasets: [{
                label: 'Звонки',
                data: [65, 59, 80, 81, 56, 55, 40],
                borderColor: '#3498db',
                tension: 0.1
            }]
        }
    });

    const operatorsCtx = document.getElementById('operatorsChart').getContext('2d');
    new Chart(operatorsCtx, {
        type: 'bar',
        data: {
            labels: ['Оператор 1', 'Оператор 2', 'Оператор 3', 'Оператор 4'],
            datasets: [{
                label: 'Звонки',
                data: [12, 19, 3, 5],
                backgroundColor: '#3498db'
            }]
        }
    });
</script>
{% endblock %} 