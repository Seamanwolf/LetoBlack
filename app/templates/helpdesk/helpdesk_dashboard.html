{% extends "base.html" %}

{% block title %}Хелпдеск{% endblock %}
{% block page_title %}Хелпдеск{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/unified_dashboard.css') }}">
{% endblock %}

{% block top_nav %}
<div class="nav-menu">
    <a href="{{ url_for('helpdesk.helpdesk_dashboard') }}" class="{% if request.endpoint == 'helpdesk.helpdesk_dashboard' %}active{% endif %}">
        <i class="fas fa-chart-bar"></i> Дашборд
    </a>
    <a href="{{ url_for('helpdesk.new_tickets') }}" class="{% if request.endpoint == 'helpdesk.new_tickets' %}active{% endif %}">
        <i class="fas fa-ticket-alt"></i> Новые заявки
    </a>
    <a href="{{ url_for('helpdesk.in_progress_tickets') }}" class="{% if request.endpoint == 'helpdesk.in_progress_tickets' %}active{% endif %}">
        <i class="fas fa-clock"></i> В работе
    </a>
    <a href="{{ url_for('helpdesk.closed_tickets') }}" class="{% if request.endpoint == 'helpdesk.closed_tickets' %}active{% endif %}">
        <i class="fas fa-check-circle"></i> Закрытые
    </a>
</div>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Статистика заявок -->
    <div class="row">
        <div class="col-md-3">
            <div class="stat-card fade-in">
                <i class="fas fa-ticket-alt stat-icon"></i>
                <div class="stat-title">Новые заявки</div>
                <div class="stat-value">5</div>
                <div class="status-warning mt-2">
                    <i class="fas fa-exclamation-triangle me-1"></i>
                    Требуют внимания
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card fade-in">
                <i class="fas fa-clock stat-icon"></i>
                <div class="stat-title">В работе</div>
                <div class="stat-value">12</div>
                <div class="status-success mt-2">
                    <i class="fas fa-check-circle me-1"></i>
                    Активно
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card fade-in">
                <i class="fas fa-check-circle stat-icon"></i>
                <div class="stat-title">Закрыто сегодня</div>
                <div class="stat-value">8</div>
                <div class="status-success mt-2">
                    <i class="fas fa-thumbs-up me-1"></i>
                    Завершено
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card fade-in">
                <i class="fas fa-hourglass-half stat-icon"></i>
                <div class="stat-title">Среднее время</div>
                <div class="stat-value">4:20</div>
                <div class="status-info mt-2">
                    <i class="fas fa-info-circle me-1"></i>
                    На решение
                </div>
            </div>
        </div>
    </div>

    <!-- График открытых и закрытых заявок -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="chart-container">
                <div class="chart-title">
                    <i class="fas fa-chart-line me-2"></i>
                    График открытых и закрытых заявок
                </div>
                <canvas id="ticketsChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- Быстрые действия -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="table-container">
                <div class="table-title">
                    <i class="fas fa-bolt me-2"></i>
                    Быстрые действия
                </div>
                <div class="d-flex gap-3 flex-wrap">
                    <a href="{{ url_for('helpdesk.new_tickets') }}" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>
                        Новая заявка
                    </a>
                    <a href="{{ url_for('helpdesk.in_progress_tickets') }}" class="btn btn-info">
                        <i class="fas fa-tasks me-2"></i>
                        Мои заявки
                    </a>
                    <a href="{{ url_for('helpdesk.closed_tickets') }}" class="btn btn-success">
                        <i class="fas fa-history me-2"></i>
                        История
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Уведомление о новой заявке -->
<div class="notification" id="notification" style="display: none;">
    <i class="fas fa-bell"></i> Новая заявка!
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
<script>
// Инициализация графика
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('ticketsChart').getContext('2d');
    
    // Данные для графика (здесь можно заменить на реальные данные)
    const data = {
        labels: ['Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота', 'Воскресенье'],
        datasets: [{
            label: 'Открытые заявки',
            data: [12, 19, 3, 5, 2, 3, 8],
            backgroundColor: 'rgba(52, 152, 219, 0.2)',
            borderColor: 'rgba(52, 152, 219, 1)',
            borderWidth: 2,
            fill: true
        }, {
            label: 'Закрытые заявки',
            data: [8, 15, 7, 9, 4, 6, 12],
            backgroundColor: 'rgba(39, 174, 96, 0.2)',
            borderColor: 'rgba(39, 174, 96, 1)',
            borderWidth: 2,
            fill: true
        }]
    };
    
    const config = {
        type: 'line',
        data: data,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    };
    
    new Chart(ctx, config);

    // Анимация появления карточек
    const cards = document.querySelectorAll('.stat-card');
    cards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'all 0.5s ease';
            
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100);
        }, index * 100);
    });
});
</script>
{% endblock %} 